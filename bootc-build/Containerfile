FROM quay.io/centos-bootc/fedora-bootc:eln

ADD https://raw.githubusercontent.com/redhat-et/locallm/main/chatbot/quadlet/chatbot.kube.example /etc/containers/systemd/chatbot.kube
ADD https://raw.githubusercontent.com/redhat-et/locallm/main/chatbot/quadlet/chatbot.yaml /etc/containers/systemd/chatbot.yml

# Change the root password
RUN echo "root:secure" | chpasswd
ADD wheel-passwordless-sudo /etc/sudoers.d/wheel-passwordless-sudo
#ADD images .

COPY storage.conf /etc/containers/storage.conf
#RUN podman load -i model-service.tar && podman load -i inference.tar && podman load -i llama2-7b.tar
#RUN rm -rf *.tar
RUN podman pull --root=/usr/lib/containers/storage quay.io/sallyom/models:llama2-7b-gguf
RUN podman pull --root=/usr/lib/containers/storage quay.io/sallyom/chatbot:inference
RUN podman pull --root=/usr/lib/containers/storage quay.io/sallyom/chatbot:model-service

#ADD cuda-rhel9.repo /etc/yum.repos.d/cuda-rhel9.repo

#add nvidia drivers (requires either a released rhel kernel in the base image or dkms) and cuda toolkit
#RUN dnf install -y nvidia-driver nvidia-gds cuda-toolkit && rm /var/log/*.log /var/lib/dnf -rf 
#RUN dnf install -y vim 
